{Nazdar Hajas
 Chcel si moj program, tak tu je.
 Je v tom mierny chaos, ktoremu ani ja sam nerozumiem.
 Ak to naozaj chces pochopit co ten program robi, musis byt velmi
 trpezlivy a musis mat fantaziu.
 Vela stastia. hahahahaha}

program Lietadlo_striela_na_lod;

Uses Dos,Crt,Graph;

Var fstr,g,t,zv,xl,cislo,yl,fl,xstr,ystr,x,y,farba,gd,gm,rychlost : Integer;
    pocit,stop,teraz,cur,velk,kr,velk1,kolkok,neznic,strela,p,g1,kon : Integer;
    m,destr,d,trefa,rana,body : Integer;
    i : LongInt;
    Colorpix,snd : Word;
    c,ano,zvuk,a : Char;
    f : text;
    path,choose,s,meno,bodys,destrs,neznics : String;
    DirInfo : SearchRec;
    l : PathStr;
    fi : File;
    ok : integer;
    cesta : String;
label 1,2,3;

procedure rdb;
var x,y,color : integer;
begin;
 assign(f,'C:\lod\moje.rdb');
 rewrite(f);
 x := 1;
 y := 1;
 setcolor(white);
 repeat;
  color := getpixel(x,y);
  writeln(f,chr(color));
  if x = 630 then
   begin;
    x := 1;
    y := y + 1;
   end;
  x := x + 1;
 until y = 479;
end;

procedure soun;
 begin;
  stop := 0;
  if zv = 1 then begin;
   Outtextxy(240,310,'OFF');
   stop := 1;
   zv := 0;
   end;
  if (zv = 0) and (stop = 0) then begin;
   Outtextxy(240,310,'ON');
   zv := 1;
  end;
  repeat;
  until keypressed;
  kr := 1;
 end;
procedure change;
 begin;
  SetColor(white);
  Rectangle(220,300,420,380);
  Outtextxy(250,310,'ENTER YOUR NEW NAME:');
  kon := 0;
   OuttextXY(230,350,meno);
  repeat;
  c := Readkey;
  if c = #8 then Delete(meno,Length(meno),2);
  if c = #13 then kon := 1;
  if c <> #8 then meno := meno + c;
  if Length(meno) >20 then Delete(meno,Length(meno),2);
  bar(225,319,400,360);
  OuttextXY(230,350,meno);
  until kon = 1;
  Delete(meno,Length(meno),2);
  kr := 1;
 end;
procedure load;
 begin;
  stop := 0;
  s := FSearch('C:\' + meno + '.sav',GetEnv('path'));
  if s  = '' then begin;
    Outtextxy(250,310,'Sorry, but i cant load');
    Outtextxy(250,330,meno);
    stop := 1;
  end;
  if stop = 0 then begin;
  SetColor(white);
  Rectangle(220,300,420,380);
  Outtextxy(270,310,'LOAD ?');
  Outtextxy(270,330,meno);
  Outtextxy(260,350,'YES');
  outtextxy(360,350,'NO');
  cur := 245;
  teraz := 0;
  repeat;
   Setcolor(lightred);
   Rectangle(cur,345,cur+50,360);
   c := Readkey;
   Setcolor(black);
   Rectangle(cur,345,cur+50,360);
   if c = #75 then teraz := 0;
   if c = #77 then teraz := 1;
   cur := 250 + (teraz * 100);
  until (c = #13) or (c = #27);
  if c = #13 then teraz := 1;
  if teraz = 1 then begin;
    assign(f,'C:\' +  meno +'.sav');
    reset(f);
    readln(f,body);
    readln(f,destr);
    readln(f,neznic);
    close(f);
   end;
  end;
  if stop = 1 then repeat;
   until keypressed;
   kr := 1;
   Setfillstyle(1,black);
   Bar(220,300,420,380);
  end;
procedure save;
 begin;
  SetColor(white);
  Rectangle(220,300,420,380);
  Outtextxy(270,310,'SAVE ?');
  Outtextxy(270,330,meno);
  Outtextxy(260,350,'YES');
  outtextxy(360,350,'NO');
  cur := 245;
  teraz := 0;
  repeat;
   Setcolor(lightred);
   Rectangle(cur,345,cur+50,360);
   c := Readkey;
   Setcolor(black);
   Rectangle(cur,345,cur+50,360);
   if c = #75 then teraz := 0;
   if c = #77 then teraz := 1;
   cur := 250 + (teraz * 100);
  until (c = #13) or (c = #27);
  if c = #13 then teraz := 1;
  if teraz = 1 then begin;
    assign(f,'C:\' +  meno +'.sav');
    {$I-}
    rewrite(f);
    {$I+}
    if IOresult <> 0 then begin;
     Cleardevice;
     closegraph;
     Writeln('To mas za to, ze nemas originalnu verziu!');
     Halt(0);
     end;
    Writeln(f,body);
    Writeln(f,destr);
    Writeln(f,neznic);
    close(f);
    kr := 1;
   end;
   Setfillstyle(1,black);
   Bar(220,300,420,380);
 end;
procedure new;
 begin;
 SetColor(white);
  Rectangle(220,300,420,380);
  Outtextxy(270,310,'BEGIN NEW GAME?');
  Outtextxy(260,350,'YES');
  outtextxy(360,350,'NO');
  cur := 245;
  teraz := 0;
  repeat;
   Setcolor(lightred);
   Rectangle(cur,345,cur+50,360);
   c := Readkey;
   Setcolor(black);
   Rectangle(cur,345,cur+50,360);
   if c = #75 then teraz := 0;
   if c = #77 then teraz := 1;
   cur := 250 + (teraz * 100);
  until (c = #13) or (c = #27);
  if c = #27 then teraz := 1;
  if teraz = 0 then begin;
    body := 0;
    destr := 0;
    neznic := 0;
     setfillstyle(1,black);
    Bar(200,80,440,400);
   end;
   kr := 1;
   Setfillstyle(1,black);
   Bar(220,300,420,380);
 end;
procedure koniec;
 begin;
  SetColor(white);
  Rectangle(220,300,420,380);
  Outtextxy(270,310,'ARE YOU SURE?');
  Outtextxy(260,350,'YES');
  outtextxy(360,350,'NO');
  cur := 245;
  teraz := 0;
  repeat;
   Setcolor(lightred);
   Rectangle(cur,345,cur+50,360);
   c := Readkey;
   Setcolor(black);
   Rectangle(cur,345,cur+50,360);
   if c = #75 then teraz := 0;
   if c = #77 then teraz := 1;
   cur := 250 + (teraz * 100);
  until (c = #13) or (c = #27);
  if (teraz = 0) and (c = #13) then begin;
   Setcolor(lightgray);
   CloseGraph;
   Writeln('Have a nice day.');
   Halt;
   end;
  if (teraz = 1) or (c = #27) then begin;
    Setfillstyle(1,black);
    Bar(220,300,420,380);
    kr := 1;
   end;
 end;
procedure menu;
 begin;
 velk := 240;
 velk1 := 240;
 Setfillstyle(1,lightblue);
 repeat;
 Setcolor(white);
 Rectangle(200,velk,440,velk1);
 Bar(200,velk,440,velk1);
 velk := velk - 1;
 velk1 := velk1 + 1;
 delay(3);
 until velk = 80;
 OuttextXY(300,100,'MENU:');
 Rectangle(210,120,430,390);
 Setfillstyle(1,black);
 Bar(211,121,429,389);
 Outtextxy(218,150,'         NEW Game');
 Outtextxy(220,170,'        SAVE Game');
 Outtextxy(220,190,'        LOAD Game');
 outtextxy(218,210,'          SOUND');
 Outtextxy(220,230,'       CHANGE NAME');
 Outtextxy(220,250,'        CONTINUE');
 Outtextxy(220,270,'          EXIT');
 teraz := 0;
 cur := 140;
 end;
procedure menopis;
 begin;
 kon := 0;
 SetFillStyle(11,lightgray);
 Bar(220,220,460,320);
 SetFillStyle(1,Black);
 Bar(200,200,440,300);
 Rectangle(200,200,440,300);
 OuttextXY(250,220,'ENTER YOUR NAME');
 Setfillstyle(1,black);
 repeat;
  c := Readkey;
  if c = #8 then Delete(meno,Length(meno),2);
  if Length(meno) > 20 then Delete(meno,Length(meno),2);
  if c = #13 then kon := 1;
  if c <> #8 then meno := meno + c;
  bar(205,229,400,298);
  OuttextXY(220,250,meno);
  until kon = 1;
  Delete(meno,Length(meno),2);
  ClearDevice;
 end;
procedure Init;
 begin;
 gd := Detect;
 InitGraph(gd,gm, 'c:\lod\');
 end;
procedure lod(xl,yl,fl : Integer);
 begin;
 SetColor(fl);
 moveto(xl - 50,yl);
 lineto(xl + 50,yl);
 lineto(xl +80,yl - 25);
 lineto(xl + 20,yl - 25);
 lineto(xl + 15,yl - 18);
 lineto(xl - 35,yl - 18);
 lineto(xl - 40,yl -20);
 lineto(xl - 70, yl - 20);
 lineto(xl - 50,yl);
 moveto(xl,yl-18);
 lineto(xl,yl-40);
 lineto(xl + 40,yl - 40);
 lineto(xl +40,yl - 25);
 moveto(xl +5,yl - 40);
 lineto(xl +5,yl - 70);
 lineto(xl + 20,yl - 70);
 lineto(xl + 25,yl -65);
 lineto(xl + 25,yl - 40);
 moveto(xl - 40,yl -20);
 lineto(xl - 40,yl - 80);
 moveto(xl - 50,yl - 60);
 lineto(xl - 30, yl - 60);
 moveto(xl - 60,yl - 50);
 lineto(xl -20,yl - 50);
 end;
procedure lietadlo(x,y,farba : Integer);
 begin;
  setcolor(farba);
  line(x -60,y,x + 40,y);
  line(x,y,x - 15, y - 15);
  line(x-15,y-15,x-35,y-15);
  line(x-35,y-15,x-50,y);
  line(x-42,y-7,x-15,y-7);
  line(x-15,y-7,x-10,y-9);
  line(x-20,y,x-5,y+5);
  line(x-5,y+5,x+25,y+5);
  line(x+25,y+5,x+10,y);
  line(x+10,y,x+35,y-20);
  line(x+35,y-20,x+50,y-17);
  line(x+50,y-17,x+40,y);
  line(x-5,y-5,x+15,y-5);
 end;
procedure stav(body,destr,neznic : Integer);
 begin;
  str(destr,destrs);
  str(body,bodys);
  str(neznic,neznics);
  setfillstyle(1,lightred);
  bar(2,467,211,475);
  bar(220,467,420,475);
  bar(432,467,620,475);
  Outtextxy(100,467,bodys);
  Outtextxy(313,467,destrs);
  Outtextxy(526,467,neznics);
 end;
procedure strel(xstr,ystr,fstr : Integer);
 begin;
 if fstr = 1 then SetColor(lightred);
 if fstr = 0 then SetColor(black);
 moveto(xstr,ystr);
 line(xstr-2,ystr,xstr+2,ystr);
 lineto(xstr+4,ystr-3);
 lineto(xstr+1,ystr-2);
 lineto(xstr,ystr- 6);
 lineto(xstr-2,ystr-3);
 lineto(xstr-5,ystr-1);
 lineto(xstr-2,ystr);
 if fstr = 1 then begin;
  setfillstyle(1,lightred);
  floodfill(xstr,ystr-2,lightred);
  SetColor(yellow);
 end;
 if fstr = 0 then begin;
  setfillstyle(1,black);
  floodfill(xstr,ystr-2,black);
  SetColor(black);
 end;
 line(xstr,ystr,xstr-3,ystr-3);
 line(xstr,ystr,xstr-1,ystr-7);
 line(xstr,ystr,xstr+5,ystr-1);
 end;
begin;
 clrscr;  {zmaze obrazovku}
 Init;
 body := 0;  {pocet bodov je nula}
 destr := 0;   {pocet znicenych lodi je nula}
 clrscr;
 kolkok := 0;
 repeat;
 kolkok := kolkok + 1;
 SetFillStyle(1,lightblue);     {voda}
 Bar(0,401,GetMaxX,GetMaxY);    {nakresli sa voda}
 neznic := 0;      {pocet neznicenych lodi je nula}
 rychlost := 3;    {rychlost lietadla je nula}
 xl := 50;         {x suradnica lode}
 yl := 400;        {y suradnica lode}
 fl := 15;           {farba lode}
 lod(xl,yl,fl);      {nakresli sa lod}
 rana := 0;          {pocet trafeni do jednej lode}
 strela := 0;        {ak strela := 1 tak strela leti z lietadla}
 x := 320;           {x suradnica lietadla}
 y := 50;            {y suradnica lietadla}
 Setfillstyle(1,lightred);  {nakresli sa tabulka t.j. pocet bodov,znicenych lodi...}
  Bar(0,450,GetMaxX,GetMaxY);
  setcolor(white);
  moveto(0,450);
  lineto(GetMaxX,450);
  lineto(getmaxX,GetMaxY);
  lineto(0,GetMaxY);
  lineto(0,450);
  lineto(0,461);
  lineto(GetMaxX,461);
  moveto(213,450);
  lineto(213,479);
  moveto(426,450);
  lineto(426,479);
  OuttextXY(90,453,'SCORE');
  OuttextXY(270,453,'DESTROYED SHIPS');
  OuttextXY(467,453,'SHIPS THAT SURVIVED');
  if kolkok = 1 then menopis;
 until kolkok = 2;
 1 : if pocit = 10 then pocit := 0;
 stav(body,destr,neznic);
 trefa := 0;
 p := 0;
 lietadlo(x ,y,15);
 if x <= 0 then begin;
 lietadlo(x,y,0);
 x := GetMaxX;
 end;
 Delay(20);
 lietadlo(x,y,0);
 x := x - rychlost;
 if strela = 1 then begin;
 PutPixel(xstr,ystr,0);
 end;
 if keypressed then begin;
 c := Readkey;
 if (c = #115) or (c = #83) then rdb;
 if c = #122 then begin;
  if zv = 0 then begin;
    zv := 1;
    goto 2;
    end;
  if zv = 1 then zv := 0;
 end;
 2 : if (strela = 0) and (c = #32) and (pocit = 0) then begin;
    if zv = 1 then snd := 900;
    strela := 1;
    xstr := x;
    ystr := y + 11;
  end;
 if c = #43 then begin;
  rychlost := rychlost + 1;
  end;
 if c = #45 then begin;
  if rychlost > 3 then rychlost := rychlost - 1;
  if rychlost < 3 then rychlost := 3;
 end;
 if c = #27 then begin;
   menu;
   repeat;
 setcolor(lightred);
 Rectangle(220,cur,420,cur + 25);
 c := Readkey;
 if c = #27 then begin;
  kr := 1;
  setfillstyle(1,black);
 Bar(200,80,440,400);
 end;
 if c = #80 then begin;
  setcolor(black);
  Rectangle(220,cur,420,cur + 25);
  teraz := teraz + 1;
  if teraz = 7 then teraz := 0;
  cur := 140 + (20 * teraz);
  end;
   if c = #72 then begin;
  setcolor(black);
  Rectangle(220,cur,420,cur + 25);
  teraz := teraz - 1;
  if teraz = -1 then teraz := 6;
  cur := 140 + (20 * teraz);
  end;
  if c = #13 then begin;
    if teraz = 6 then begin;
    koniec;
    teraz := 6;
    cur := 260;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    setcolor(black);
    Rectangle(220,cur,420,cur + 25);
    end;
    if teraz = 0 then begin;
    new;
    teraz := 0;
    cur := 140;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    setcolor(black);
    Rectangle(220,cur,420,cur + 25);
    end;
    if teraz = 1 then begin;
    save;
    teraz := 1;
    cur := 140;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    setcolor(black);
    Rectangle(220,cur,420,cur + 25);
    end;
    if teraz = 2 then begin;
    load;
    teraz := 2;
    cur := 140;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    setcolor(black);
    Rectangle(220,cur,420,cur + 25);
    end;
    if teraz = 3 then begin;
    soun;
    teraz := 3;
    cur := 140;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    setcolor(black);
    Rectangle(220,cur,420,cur + 25);
    end;
    if teraz = 4 then begin;
    change;
    teraz := 4;
    cur := 140;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    setcolor(black);
    Rectangle(220,cur,420,cur + 25);
    end;
    if teraz = 5 then begin;
    setfillstyle(1,black);
    Bar(200,80,440,400);
    kr := 1;
    end;
   end;
 until kr = 1;
 kr := 0;
 goto 1;
 end;
 end;
 if strela = 1 then begin;
  repeat;
  p := p + 1;
  Colorpix := GetPixel(xstr,1+ystr);
  if colorpix = 15 then begin;
   if (pocit = 10) or (pocit = 0) then pocit := 1;
   strela := 0;
   if zv = 1 then begin;
   Sound(100);
   NoSound;
   end;
   rana := rana + 1;
   body := body + 1;
   if rana = 5 then begin;
   if zv = 1 then begin;
    Sound(300);
    NoSound;
    end;
   destr := destr + 1;
   fl := 0;
   lod(xl,yl,fl);
   xl := 50;
   yl := 400;
   fl := 15;
   lod(xl,yl,fl);
   end;
  end;
  ystr := ystr + 1;
 until p = 8;
 end;
 if ystr > 400 then strela := 0;
 if strela = 1 then begin ;
 if zv = 1 then begin;
 snd := snd - 3;
 Sound(snd);
 Delay(5);
 NoSound;
 end;
 PutPixel(xstr,ystr,15);
 end;
 lod(xl,yl,0);
 xl := xl + 1;
 if xl > GetMaxX then begin;
  xl := 50;
  neznic := neznic + 1;
  end;
 lod(xl,yl,15);
 if (pocit < 10) and (pocit >= 1) and (rana < 5) then begin;
  strel(xstr+pocit,ystr-5,0);
  pocit := pocit + 1;
  strel(xstr+pocit,ystr-5,1);
 end;
 if rana = 5  then begin;
  strel(xstr+pocit,ystr-5,0);
  pocit :=10;
 end;
 if (pocit = 10) then strel(xstr+pocit,ystr-5,0);
 if rana = 5 then rana := 0;
 goto 1;
end.